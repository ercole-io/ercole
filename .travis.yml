version: ~> 1.0
language: go
go:
  - 1.13.x
env:
  - MONGODB_URI=mongodb://127.0.0.1:27017
  - VERSION=latest
services:
  - mongodb
install:
  - go get -v
  - go get github.com/golang/mock/mockgen@latest
script: 
  - go generate -v ./...
  - go build -o ercole
  - go test -v ./...
  - ./ercole version
  - mkdir -p ~/rpmbuild/{BUILD,BUILDROOT,RPMS,SOURCES,SPECS,SRPMS}
  - ln -s $PWD ~/rpmbuild/SOURCES/ercole-${VERSION}
  - rpmbuild -bb package/rhel7/ercole.spec
  - ls ~/rpmbuild/RPMS/x86_64/ercole-*.rpm
  - file ~/rpmbuild/RPMS/x86_64/ercole-*.rpm